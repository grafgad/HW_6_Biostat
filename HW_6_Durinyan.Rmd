---
title: "HW_6_Durinyan"
output: html_document
date: "2024-04-17"
---

```{r}
library(tidyverse)
library(PowerTOST)
library(TrialSize)
```


При выполнении этого домашнего задания вам необходимо посчитать выборки для различных типов точек. Напишите соответствующий код, пользуясь указанными формулами.

Пусть наш спонсор заинтересован, чтобы исследование имело 80% мощность, а уровень значимости — 5%, ожидаемый drop-out rate = 10%.

```{r}
alpha_ <- 0.05
beta_ <- 0.2
dropOut_rate <- 0.1
power <- 0.80
```

Определеим общие функции для всех заданий
```{r}
# Z-значения
Z_alpha_2 <- qnorm(1 - alpha / 2)
Z_beta <- qnorm(power)

# Размер выборки
n_total <- function(n1, n2) {
  # Коррекция на drop-out_rate
  n1_adj<- ceiling(n1 / (1 - dropOut_rate))
  n2_adj <- ceiling(n2 / (1 - dropOut_rate))
  # Рассчет общего размера выборки
  return(n1_adj + n2_adj)
}

```


### Задание 1
Рассчитайте выборку для исследования терапевтической эквивалентности для двухпериодного cross-over дизайна. Из предыдущих исследований известно, что дисперсия составляет 20%, а разница средних составляет −10%. Клиницисты сообщают нам, что клинически значимая разница составляет 25%.

```{r}
sigma_m <- 0.2
epsilon <- -0.1
delta <- 0.25

n1 <- n2 <- ((Z_alpha_2 + Z_beta)^2 * sigma_m^2) / (2 * (delta - abs(epsilon))^2)

cat("Выборка для исследования терапевтической эквивалентности для двухпериодного cross-over дизайна =", n_total(n1, n2))
```

### Задание 2
Рассчитайте выборку для гипотезы non-inferiority для двухвыборочного параллельного дизайна. Пусть клинически значимая разница = -0.1, то есть мы ожидаем разницу не меньше 10%, а долю ответов для тестового препарата = 0.65, в то время как нам известно из предыдущих исследований, что доля ответов у препарата сравнения составляет = 0.85. Соотношение групп равно = 1.

```{r}
delta <- -0.1
p1_ <- 0.85
p2_ <- 0.65
k <- 1

n1 <- n2 <- ((Z_alpha_2 + Z_beta)^2 * (p1 * (1 - p1) + p2 * (1 - p2))) / ((p1 - p2 - delta)^2)

cat('Выборка для гипотезы non-inferiority для двухвыборочного параллельного дизайна =', n_total(n1, n2))
```

### Задание 3
Рассчитайте выборку для гипотезы equality для следующего исследования. Мы хотим сравнить новую терапию инфекции, присоединяющейся в больничных условиях у пациентов с ожогами, с золотым стандартом, основываясь на данных, анализируемых с помощью регрессии Кокса. Пусть отношение рисков «золотой стандарт / новая терапия», hazard ratio, HR = 2. Мы предполагаем, что 80% пациентов (d = 0.8) могут столкнуться с этим заболеванием. Соотношения групп терапии равны (p1 = p2 = 0.5).


```{r}
HR <- 2
d <- 0.8
p1 <- 0.5
p2 <- 0.5

n1 <- n2 <- ((Z_alpha_2 + Z_beta)^2) / (log(HR)^2 * p1 * p2 * d)

cat('Выборка для гипотезы equality для исследования терапии нозокомиальной флоры комбустиологичнского отделения =', n_total(n1, n2))
```



